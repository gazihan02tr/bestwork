<!DOCTYPE html>
<html lang="tr">
<head>
    {% block head %}
        <script>
            (function() {
                const root = document.documentElement;
                let storedTheme;
                try {
                    storedTheme = localStorage.getItem("bestsoftTheme");
                } catch (error) {
                    storedTheme = null;
                }
                const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
                const enableDark = storedTheme === "dark" || (!storedTheme && prefersDark);
                root.classList.toggle("dark", enableDark);
                root.dataset.theme = enableDark ? "dark" : "light";
                window.__bestsoftTheme = enableDark ? "dark" : "light";
            })();
        </script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        colors: {
                            'bs-surface': '#ffffff',
                            'bs-surface-dark': '#0f172a',
                            'bs-border': '#e5e7eb',
                            'bs-border-dark': '#1f2937',
                            'bs-text': '#111827',
                            'bs-text-muted': '#4b5563'
                        }
                    }
                }
            };
        </script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/flowbite@4.0.1/dist/flowbite.min.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/flowbite@4.0.1/dist/flowbite.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
        <title>{% block title %}{% endblock %} - BestSoft</title>
    {% endblock %}
</head>
<body class="min-h-screen bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100 transition-colors duration-300" data-theme="light">
{% include 'bestsoft/inc/menu.html'%}
<button data-drawer-target="separator-sidebar" data-drawer-toggle="separator-sidebar" aria-controls="separator-sidebar" type="button" class="text-slate-700 dark:text-slate-200 bg-white/70 dark:bg-slate-800/70 border border-slate-200/60 dark:border-slate-700/60 hover:bg-white dark:hover:bg-slate-800 focus:ring-4 focus:ring-violet-200 dark:focus:ring-violet-500 font-medium rounded-lg ms-3 mt-3 text-sm p-2 focus:outline-none inline-flex sm:hidden transition">
   <span class="sr-only">Open sidebar</span>
   <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5 7h14M5 12h14M5 17h10"/>
   </svg>
</button>

<div class="p-4 sm:ml-64 transition-colors duration-300">
   <div class="p-4 border border-dashed border-slate-200 dark:border-slate-700 rounded-2xl bg-white/90 dark:bg-slate-900/70 backdrop-blur">
       <div id="content">{% block content %}{% endblock %}</div>

   </div>
</div>
{% set bestsoft_flash_messages = get_flashed_messages(with_categories=True) %}
{% if bestsoft_flash_messages %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const configMap = {
            success: { icon: 'success', title: 'Başarılı' },
            error: { icon: 'error', title: 'Hata' },
            warning: { icon: 'warning', title: 'Uyarı' },
            info: { icon: 'info', title: 'Bilgi' },
            default: { icon: 'question', title: 'Bilgi' },
        };
        const messages = {{ bestsoft_flash_messages|tojson|safe }};
        if (!messages.length) return;
        const showAlert = ([category, message]) => {
            const conf = configMap[category] || configMap.default;
            return Swal.fire({
                icon: conf.icon,
                title: conf.title,
                text: message,
                background: '#fbf6ff',
                color: '#2b0c66',
                customClass: {
                    popup: 'swal2-purple-popup',
                    title: 'swal2-purple-title',
                },
                showConfirmButton: false,
                showCloseButton: true,
                timer: 2500,
                timerProgressBar: true,
                allowOutsideClick: true,
            });
        };
        let chain = Promise.resolve();
        messages.forEach(msg => {
            chain = chain.then(() => showAlert(msg));
        });
    });
</script>
{% endif %}
<script>
    (function() {
        const root = document.documentElement;
        const body = document.body;
        function updateTheme(mode) {
            const enableDark = mode === "dark";
            root.classList.toggle("dark", enableDark);
            root.dataset.theme = mode;
            if (body) {
                body.dataset.theme = mode;
            }
            try {
                localStorage.setItem("bestsoftTheme", mode);
            } catch (error) {
                /* ignore storage failures */
            }
            const icon = document.querySelector("[data-theme-icon]");
            if (icon) {
                icon.textContent = enableDark ? "light_mode" : "dark_mode";
            }
        }
        document.addEventListener("DOMContentLoaded", function() {
            const initialMode = window.__bestsoftTheme || (root.classList.contains("dark") ? "dark" : "light");
            updateTheme(initialMode);
            const toggle = document.querySelector("[data-theme-toggle]");
            if (toggle) {
                toggle.addEventListener("click", function() {
                    const currentMode = root.classList.contains("dark") ? "dark" : "light";
                    const nextMode = currentMode === "dark" ? "light" : "dark";
                    updateTheme(nextMode);
                });
            }
        });
    })();
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("[data-file-input]").forEach((input) => {
            const targetSelector = input.getAttribute("data-file-label");
            if (!targetSelector) {
                return;
            }
            const target = document.querySelector(targetSelector);
            if (!target) {
                return;
            }
            const defaultText = target.textContent || "Dosya seçilmedi";
            input.addEventListener("change", () => {
                const files = input.files;
                if (files && files.length) {
                    target.textContent = files.length === 1 ? files[0].name : `${files.length} dosya seçildi`;
                } else {
                    target.textContent = defaultText;
                }
            });
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const toggle = document.getElementById("ecommerce-menu-toggle");
        const menu = document.getElementById("ecommerce-menu");
        if (!toggle || !menu) {
            return;
        }
        const storageKey = "bestsoftEcommerceMenuOpen";
        let isOpen = true;
        try {
            const stored = localStorage.getItem(storageKey);
            if (stored === "false") {
                isOpen = false;
            }
        } catch (error) {
            isOpen = true;
        }
        const applyState = (open) => {
            menu.classList.toggle("hidden", !open);
            toggle.setAttribute("aria-expanded", open ? "true" : "false");
        };
        applyState(isOpen);
        toggle.addEventListener("click", () => {
            isOpen = !isOpen;
            try {
                localStorage.setItem(storageKey, isOpen ? "true" : "false");
            } catch (error) {
                /* ignore storage errors */
            }
            applyState(isOpen);
        });
    });
</script>
</body>
</html>
