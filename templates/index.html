{% extends "inc/base.html" %}
{% block title %}Ana Sayfa{% endblock %}
{% block head %}
    {{ super() }}
    <style>
        .leader-slider {
            width: 100%;
        }

        .leader-slider .slider-shell {
            display: flex;
            justify-content: center;
            position: relative;
            width: 100%;
            height: 60vh;
            overflow: hidden;
            border-radius: 1rem;
            background-color: #ffffff;
        }

        .leader-slider .slider-viewport {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            border-radius: inherit;
            background-color: transparent;
        }

        .leader-slider .slides {
            height: 100%;
            border-radius: inherit;
        }

        .leader-slider .slides img {
            height: 100%;
            width: 100%;
            object-fit: cover;
            border-radius: inherit;
            background-color: #ffffff;
        }
    </style>
{% endblock %}
{% block content %}
        <!-- Hero Section -->
<section class="bg-white text-slate-900 relative overflow-hidden">
    <div class="w-full max-w-none mx-auto px-[2%] py-6 sm:py-6 relative z-10 bg-white">
        {% set slider_items = slider_images if slider_images is defined else [] %}
        {% if slider_items %}
        <div class="leader-slider relative mx-auto" data-leader-slider data-slider-interval="{{ slider_transition_seconds|default(6.5) }}">
            <div class="slider-shell relative w-full">
                <div class="slider-viewport overflow-hidden rounded-2xl bg-white shadow-2xl shadow-black/10">
                    <div class="slides flex h-full w-full transition-transform duration-500 ease-out" data-slider-track data-index="0">
                        {% for image in slider_items %}
                        <img
                            class="h-full w-full flex-shrink-0 object-cover"
                            src="{{ image.url }}"
                            alt="Slider görseli {{ loop.index }}"
                            loading="lazy"
                        >
                        {% endfor %}
                    </div>
                    <div class="dots absolute bottom-4 flex w-full justify-center gap-2" data-slider-dots>
                        {% for image in slider_items %}
                        <span class="dot h-2 w-2 rounded-full bg-gray-400 cursor-pointer transition-all border border-white/20" data-dot-index="{{ loop.index0 }}"></span>
                        {% endfor %}
                    </div>
                </div>
                <button
                    type="button"
                    class="prev absolute left-4 top-1/2 -translate-y-1/2 rounded-full bg-white/80 backdrop-blur-md p-3 text-gray-900 shadow-lg hover:bg-white hover:scale-110 transition"
                    data-slider-prev
                    aria-label="Önceki slayt"
                >&#10094;</button>
                <button
                    type="button"
                    class="next absolute right-4 top-1/2 -translate-y-1/2 rounded-full bg-white/80 backdrop-blur-md p-3 text-gray-900 shadow-lg hover:bg-white hover:scale-110 transition"
                    data-slider-next
                    aria-label="Sonraki slayt"
                >&#10095;</button>
            </div>
        </div>
        {% else %}
        <div class="rounded-[28px] border border-dashed border-slate-200 bg-white/80 py-16 flex items-center justify-center text-center">
            <p class="text-sm sm:text-base text-slate-500">
                Henüz slider görseli yüklenmemiş. BestSoft panelinden yeni görseller ekleyebilirsiniz.
            </p>
        </div>
        {% endif %}
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const slider = document.querySelector("[data-leader-slider]");
        if (!slider) return;
        const track = slider.querySelector("[data-slider-track]");
        const slideImages = Array.from(track?.querySelectorAll("img") || []);
        const prevBtn = slider.querySelector("[data-slider-prev]");
        const nextBtn = slider.querySelector("[data-slider-next]");
        const dotsWrap = slider.querySelector("[data-slider-dots]");
        const dots = Array.from(dotsWrap?.querySelectorAll(".dot") || []);
        if (!slideImages.length) return;

        const intervalSeconds = parseFloat(slider.dataset.sliderInterval || "6.5");
        const transitionIntervalMs = Math.max(intervalSeconds, 1) * 1000;
        let currentIndex = 0;
        let autoplay;
        const totalSlides = slideImages.length;
        const hasMultiple = totalSlides > 1;

        function updateDots() {
            dots.forEach((dot, dotIndex) => {
                if (dotIndex === currentIndex) {
                    dot.classList.add("bg-gray-900", "scale-125");
                    dot.classList.remove("bg-gray-400");
                } else {
                    dot.classList.remove("bg-gray-900", "scale-125");
                    dot.classList.add("bg-gray-400");
                }
            });
        }

        function goToSlide(newIndex) {
            currentIndex = (newIndex + totalSlides) % totalSlides;
            track.style.transform = `translateX(-${currentIndex * 100}%)`;
            updateDots();
        }

        function nextSlide() {
            goToSlide(currentIndex + 1);
        }

        function prevSlide() {
            goToSlide(currentIndex - 1);
        }

        function restartAutoplay() {
            if (!hasMultiple) return;
            clearInterval(autoplay);
            autoplay = setInterval(nextSlide, transitionIntervalMs);
        }

        dots.forEach((dot, dotIndex) => {
            dot.addEventListener("click", () => {
                goToSlide(dotIndex);
                restartAutoplay();
            });
        });

        updateDots();
        if (hasMultiple) {
            autoplay = setInterval(nextSlide, transitionIntervalMs);
        } else {
            prevBtn?.classList.add("opacity-40", "pointer-events-none");
            nextBtn?.classList.add("opacity-40", "pointer-events-none");
        }

        prevBtn?.addEventListener("click", () => {
            prevSlide();
            restartAutoplay();
        });
        nextBtn?.addEventListener("click", () => {
            nextSlide();
            restartAutoplay();
        });

        slider.addEventListener("mouseenter", () => {
            if (hasMultiple) clearInterval(autoplay);
        });
        slider.addEventListener("mouseleave", () => {
            if (hasMultiple) restartAutoplay();
        });
    });
</script>

<!-- Categories Section -->
    <section class="py-12 sm:py-16 lg:py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl sm:text-4xl font-normal mb-2 text-on-background">Kategoriler</h2>
                <p class="text-lg text-on-surface-variant">İhtiyacınıza uygun ürün grubunu seçin</p>
            </div>
            
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                
                <!-- Category Card 1 -->
                <a href="#" class="group bg-surface rounded-2xl elevation-1 hover:elevation-3 overflow-hidden transition-all duration-300 state-layer">
                    <div class="aspect-square bg-gradient-to-br from-purple-400 to-purple-600 flex items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-br from-purple-400/90 to-purple-600/90"></div>
                        <img src="https://images.unsplash.com/photo-1505576399279-565b52d4ac71?w=800&q=80" alt="Beslenme" class="absolute inset-0 w-full h-full object-cover mix-blend-overlay opacity-60">
                        <div class="absolute inset-0 bg-amber-300 opacity-0 group-hover:opacity-20 transition-opacity"></div>
                        <span class="relative z-10 text-white text-6xl font-bold">B</span>
                    </div>
                    <div class="p-4 sm:p-6">
                        <h3 class="text-lg sm:text-xl font-medium mb-1">Beslenme</h3>
                        <p class="text-sm text-on-surface-variant">Vitaminler ve takviyeler</p>
                    </div>
                </a>

                <!-- Category Card 2 -->
                <a href="#" class="group bg-surface rounded-2xl elevation-1 hover:elevation-3 overflow-hidden transition-all duration-300 state-layer">
                    <div class="aspect-square bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-br from-amber-400/90 to-amber-600/90"></div>
                        <img src="https://images.unsplash.com/photo-1596755389378-c31d21fd1273?w=800&q=80" alt="Güzellik" class="absolute inset-0 w-full h-full object-cover mix-blend-overlay opacity-60">
                        <div class="absolute inset-0 bg-purple-400 opacity-0 group-hover:opacity-20 transition-opacity"></div>
                        <span class="relative z-10 text-white text-6xl font-bold">G</span>
                    </div>
                    <div class="p-4 sm:p-6">
                        <h3 class="text-lg sm:text-xl font-medium mb-1">Güzellik</h3>
                        <p class="text-sm text-on-surface-variant">Cilt ve saç bakımı</p>
                    </div>
                </a>

                <!-- Category Card 3 -->
                <a href="#" class="group bg-surface rounded-2xl elevation-1 hover:elevation-3 overflow-hidden transition-all duration-300 state-layer">
                    <div class="aspect-square bg-gradient-to-br from-yellow-400 to-yellow-600 flex items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/90 to-yellow-600/90"></div>
                        <img src="https://images.unsplash.com/photo-1585421514738-01798e348b17?w=800&q=80" alt="Ev Bakımı" class="absolute inset-0 w-full h-full object-cover mix-blend-overlay opacity-60">
                        <div class="absolute inset-0 bg-purple-400 opacity-0 group-hover:opacity-20 transition-opacity"></div>
                        <span class="relative z-10 text-white text-6xl font-bold">E</span>
                    </div>
                    <div class="p-4 sm:p-6">
                        <h3 class="text-lg sm:text-xl font-medium mb-1">Ev Bakımı</h3>
                        <p class="text-sm text-on-surface-variant">Temizlik ürünleri</p>
                    </div>
                </a>

                <!-- Category Card 4 -->
                <a href="#" class="group bg-surface rounded-2xl elevation-1 hover:elevation-3 overflow-hidden transition-all duration-300 state-layer">
                    <div class="aspect-square bg-gradient-to-br from-violet-400 to-violet-600 flex items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-br from-violet-400/90 to-violet-600/90"></div>
                        <img src="https://images.unsplash.com/photo-1556228578-0d85b1a4d571?w=800&q=80" alt="Kişisel Bakım" class="absolute inset-0 w-full h-full object-cover mix-blend-overlay opacity-60">
                        <div class="absolute inset-0 bg-amber-300 opacity-0 group-hover:opacity-20 transition-opacity"></div>
                        <span class="relative z-10 text-white text-6xl font-bold">K</span>
                    </div>
                    <div class="p-4 sm:p-6">
                        <h3 class="text-lg sm:text-xl font-medium mb-1">Kişisel Bakım</h3>
                        <p class="text-sm text-on-surface-variant">Günlük bakım</p>
                    </div>
                </a>

            </div>
        </div>
    </section>

    <!-- Featured Products -->
    <section id="urunler" class="py-12 sm:py-16 lg:py-20 bg-surface-variant/30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <div class="flex items-end justify-between mb-10">
                <div>
                    <h2 class="text-3xl sm:text-4xl font-normal mb-2 text-on-background">Öne Çıkan Ürünler</h2>
                    <p class="text-lg text-on-surface-variant">En çok tercih edilen ürünlerimiz</p>
                </div>
                <a href="#urunler" class="hidden sm:inline-flex items-center gap-1 text-primary font-medium hover:gap-2 transition-all">
                    Tümünü Gör
                    <span class="material-symbols-outlined">arrow_forward</span>
                </a>
            </div>

            {% if products %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                {% for product in products %}
                <div class="group bg-surface rounded-2xl elevation-2 hover:elevation-4 overflow-hidden transition-all duration-300">
                    <div class="relative aspect-square bg-surface-variant flex items-center justify-center overflow-hidden">
                        <img src="{{ product.image_url }}" alt="{{ product.name }}" class="w-full h-full object-cover">
                        <button class="absolute top-3 right-3 p-2 bg-surface rounded-full elevation-1 state-layer text-on-surface opacity-0 group-hover:opacity-100 transition-opacity">
                            <span class="material-symbols-outlined text-xl">favorite</span>
                        </button>
                    </div>
                    <div class="p-5 space-y-4">
                        <div>
                            <p class="text-xs uppercase tracking-wide text-on-surface-variant">{{ product.category }}</p>
                            <h3 class="font-medium text-lg text-on-surface line-clamp-2">{{ product.name }}</h3>
                            <p class="text-sm text-on-surface-variant line-clamp-2 mt-1">{{ product.description }}</p>
                        </div>
                        <div class="flex items-baseline gap-2">
                            <span class="text-2xl font-bold text-primary">{{ '%.2f'|format(product.price) }} ₺</span>
                        </div>
                        <form method="post" action="{{ url_for('add_to_cart', product_id=product.id) }}" class="flex items-center gap-3">
                            <label for="qty-{{ product.id }}" class="text-sm text-on-surface-variant">Adet</label>
                            <input
                                id="qty-{{ product.id }}"
                                name="quantity"
                                type="number"
                                min="1"
                                value="1"
                                class="w-16 px-3 py-2 rounded-lg border border-outline-variant focus:outline-none focus:ring-2 focus:ring-primary text-center bg-surface-variant"
                            >
                            <button type="submit" class="flex-1 py-3 bg-primary text-on-primary rounded-full font-medium hover:elevation-1 transition-all state-layer">
                                Sepete Ekle
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="bg-surface rounded-2xl elevation-1 px-8 py-12 text-center text-on-surface-variant">
                Şu anda listelenecek ürün bulunamadı. Lütfen daha sonra tekrar deneyin.
            </div>
            {% endif %}

        </div>
    </section>

    {% set certificate_items = certificate_images if certificate_images is defined else [] %}
    {% if certificate_items %}
    <!-- Certificates Section -->
    <section id="sertifikalar" class="py-12 sm:py-16 lg:py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-10">
                <p class="text-sm uppercase tracking-[0.32em] text-primary font-semibold">SERTİFİKALAR</p>
            </div>
            <div class="relative pb-12" data-cert-slider>
                <button
                    type="button"
                    class="absolute -top-6 right-14 flex items-center justify-center w-10 h-10 rounded-full bg-white text-slate-700 border border-outline shadow hover:bg-slate-50 transition z-10"
                    aria-label="Önceki sertifikalar"
                    data-cert-prev
                >
                    <span class="material-symbols-outlined text-lg">chevron_left</span>
                </button>
                <button
                    type="button"
                    class="absolute -top-6 right-2 flex items-center justify-center w-10 h-10 rounded-full bg-white text-slate-700 border border-outline shadow hover:bg-slate-50 transition z-10"
                    aria-label="Sonraki sertifikalar"
                    data-cert-next
                >
                    <span class="material-symbols-outlined text-lg">chevron_right</span>
                </button>
                <div class="overflow-hidden" data-cert-slider-viewport>
                    <div class="flex gap-5 transition-transform duration-500 will-change-transform" data-cert-slider-track>
                        {% for certificate in certificate_items %}
                        <div class="flex-shrink-0" data-cert-slide>
                            <button
                                type="button"
                                class="w-full group relative overflow-hidden rounded-3xl border border-outline-variant bg-surface shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/50"
                                data-certificate-trigger
                                data-cert-src="{{ certificate.url }}"
                                data-cert-title="{{ certificate.title }}"
                                data-cert-alt="{{ certificate.alt_text }}"
                            >
                                <img src="{{ certificate.url }}" alt="{{ certificate.alt_text }}" class="w-full h-64 object-cover transition duration-500 group-hover:scale-105">
                                <div class="absolute inset-0 bg-gradient-to-t from-slate-900/70 via-slate-900/20 to-transparent opacity-80"></div>
                                <div class="absolute inset-x-0 bottom-0 p-5 flex items-center justify-between text-left text-white">
                                    <div>
                                        <p class="text-sm text-white/70 uppercase tracking-wide">Sertifika</p>
                                        <h3 class="text-lg font-semibold">{{ certificate.title }}</h3>
                                    </div>
                                    <span class="material-symbols-outlined text-3xl opacity-80 group-hover:opacity-100 transition">open_in_full</span>
                                </div>
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="certificate-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-900/70 backdrop-blur-sm px-4">
        <div class="relative w-full max-w-4xl mx-auto rounded-3xl bg-white shadow-2xl overflow-hidden animate-[fadeIn_0.25s_ease-out]">
            <button type="button" class="absolute top-4 right-4 w-10 h-10 rounded-full bg-black/70 text-white flex items-center justify-center hover:bg-black transition" data-certificate-close aria-label="Kapat">
                <span class="material-symbols-outlined">close</span>
            </button>
            <div class="p-6 flex flex-col gap-4">
                <div class="flex items-start justify-between gap-4">
                    <div>
                        <p class="text-sm uppercase tracking-[0.3em] text-primary/70 font-semibold">Sertifika</p>
                        <h3 id="certificate-modal-title" class="text-2xl font-semibold text-slate-900">Sertifika</h3>
                    </div>
                </div>
                <div class="rounded-2xl overflow-hidden border border-outline-variant bg-slate-50">
                    <img id="certificate-modal-image" src="" alt="Sertifika" class="w-full max-h-[70vh] object-contain bg-slate-900/5">
                </div>
                <div class="flex items-center justify-end">
                    <a
                        id="certificate-download"
                        href="#"
                        download
                        class="inline-flex items-center gap-2 px-5 py-2 rounded-full bg-slate-900 text-white font-medium shadow hover:bg-slate-800 transition"
                        title="Sertifikayı indir"
                    >
                        <span class="material-symbols-outlined text-base">download</span>
                        İndir
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% set band_items = site_branding.security_band %}
    {% if band_items %}
    <!-- Benefits Section -->
    <section class="py-12 sm:py-16 lg:py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 sm:gap-8">
                {% set palettes = [
                    {'bg': 'bg-primary-container', 'text': 'text-primary'},
                    {'bg': 'bg-secondary-container', 'text': 'text-secondary'},
                    {'bg': 'bg-tertiary-container', 'text': 'text-tertiary'}
                ] %}
                {% for item in band_items %}
                {% set palette = palettes[loop.index0 % palettes|length] %}
                <div class="text-center rounded-2xl border border-outline-variant bg-white/80 p-6 shadow-sm">
                    <div class="inline-flex items-center justify-center w-16 h-16 {{ palette.bg }} rounded-full mb-4">
                        <span class="material-symbols-outlined {{ palette.text }} text-3xl">{{ item.icon }}</span>
                    </div>
                    <h3 class="text-xl font-medium mb-2">{{ item.title }}</h3>
                    <p class="text-on-surface-variant">{{ item.description }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Newsletter Section -->
    <section class="py-12 sm:py-16 lg:py-20 bg-gradient-to-r from-primary via-purple-600 to-purple-700 text-white relative overflow-hidden">
        <div class="absolute inset-0 opacity-20">
            <div class="absolute top-0 left-1/4 w-96 h-96 bg-secondary rounded-full blur-3xl"></div>
            <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-amber-400 rounded-full blur-3xl"></div>
        </div>
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
            <span class="material-symbols-outlined text-secondary mb-4" style="font-size: 48px;">mail</span>
            <h2 class="text-3xl sm:text-4xl font-normal mb-3">Kampanyalardan Haberdar Olun</h2>
            <p class="text-lg opacity-90 mb-8">Özel fırsatlar ve yeni ürünlerden ilk siz haberdar olun</p>
            
            <div class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
                <input 
                    type="email" 
                    placeholder="E-posta adresiniz" 
                    class="flex-1 px-6 py-4 rounded-full bg-white/20 backdrop-blur-sm text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-secondary border border-white/30"
                >
                <button class="px-8 py-4 bg-secondary text-on-secondary rounded-full font-medium hover:bg-amber-500 transition-all shadow-lg whitespace-nowrap">
                    Kayıt Ol
                </button>
            </div>
        </div>
    </section>

    {% if certificate_items %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const sliderRoot = document.querySelector("[data-cert-slider]");
            const sliderTrack = sliderRoot?.querySelector("[data-cert-slider-track]");
            const sliderSlides = sliderTrack ? Array.from(sliderTrack.querySelectorAll("[data-cert-slide]")) : [];
            const prevBtn = sliderRoot?.querySelector("[data-cert-prev]");
            const nextBtn = sliderRoot?.querySelector("[data-cert-next]");
            let slidesPerView = 1;
            let currentIndex = 0;
            let slideWidth = 0;
            let sliderGap = 0;
            let resizeTimeout;

            const setButtonState = (btn, disabled) => {
                if (!btn) return;
                btn.disabled = disabled;
                btn.classList.toggle("opacity-40", disabled);
                btn.classList.toggle("pointer-events-none", disabled);
            };

            const updateNavVisibility = () => {
                if (!sliderSlides.length) return;
                const shouldShow = sliderSlides.length > slidesPerView;
                [prevBtn, nextBtn].forEach((btn) => {
                    if (!btn) return;
                    btn.classList.toggle("hidden", !shouldShow);
                });
            };

            const updateButtons = () => {
                const maxIndex = Math.max(0, sliderSlides.length - slidesPerView);
                setButtonState(prevBtn, currentIndex <= 0);
                setButtonState(nextBtn, currentIndex >= maxIndex);
            };

            const updateSliderPosition = (skipAnimation = false) => {
                if (!sliderTrack) return;
                const offset = currentIndex * (slideWidth + sliderGap);
                if (skipAnimation) {
                    const previousTransition = sliderTrack.style.transition;
                    sliderTrack.style.transition = "none";
                    sliderTrack.style.transform = `translateX(-${offset}px)`;
                    requestAnimationFrame(() => {
                        sliderTrack.style.transition = previousTransition;
                    });
                } else {
                    sliderTrack.style.transform = `translateX(-${offset}px)`;
                }
                updateButtons();
            };

            const measureSlider = () => {
                if (!sliderRoot || !sliderTrack || !sliderSlides.length) return;
                const containerWidth = sliderRoot.clientWidth;
                if (!containerWidth) return;
                slidesPerView = window.innerWidth < 640 ? 1 : window.innerWidth < 1024 ? 2 : 4;
                const computedStyle = window.getComputedStyle(sliderTrack);
                const parsedGap = parseFloat(computedStyle.columnGap || computedStyle.gap || "0");
                sliderGap = Number.isNaN(parsedGap) ? 0 : parsedGap;
                const usableWidth = containerWidth - sliderGap * Math.max(slidesPerView - 1, 0);
                slideWidth = usableWidth / slidesPerView;
                sliderSlides.forEach((slide) => {
                    slide.style.flex = `0 0 ${slideWidth}px`;
                    slide.style.maxWidth = `${slideWidth}px`;
                });
                const maxIndex = Math.max(0, sliderSlides.length - slidesPerView);
                currentIndex = Math.min(currentIndex, maxIndex);
                updateNavVisibility();
                updateSliderPosition(true);
            };

            if (sliderRoot && sliderTrack && sliderSlides.length) {
                measureSlider();
                window.addEventListener("resize", () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(measureSlider, 150);
                });
                prevBtn?.addEventListener("click", () => {
                    if (currentIndex <= 0) return;
                    currentIndex -= 1;
                    updateSliderPosition();
                });
                nextBtn?.addEventListener("click", () => {
                    const maxIndex = Math.max(0, sliderSlides.length - slidesPerView);
                    if (currentIndex >= maxIndex) return;
                    currentIndex += 1;
                    updateSliderPosition();
                });
            }

            const modal = document.getElementById("certificate-modal");
            const modalImage = document.getElementById("certificate-modal-image");
            const modalTitle = document.getElementById("certificate-modal-title");
            const downloadLink = document.getElementById("certificate-download");
            const triggers = document.querySelectorAll("[data-certificate-trigger]");
            const closeButtons = document.querySelectorAll("[data-certificate-close]");

            if (!modal || !modalImage || !modalTitle || !downloadLink || !triggers.length) {
                return;
            }
            const openModal = (src, title, altText) => {
                modalImage.src = src;
                modalImage.alt = altText || title || "Sertifika";
                modalTitle.textContent = title || "Sertifika";
                downloadLink.href = src;
                const normalizedName = (title || "sertifika").trim().replace(/\\s+/g, "_").toLowerCase() || "sertifika";
                downloadLink.setAttribute("download", `${normalizedName}.webp`);
                modal.classList.remove("hidden");
                modal.classList.add("flex");
                document.body.classList.add("overflow-hidden");
            };

            const closeModal = () => {
                modal.classList.add("hidden");
                modal.classList.remove("flex");
                document.body.classList.remove("overflow-hidden");
            };

            triggers.forEach((trigger) => {
                trigger.addEventListener("click", () => {
                    const src = trigger.getAttribute("data-cert-src") || "";
                    const title = trigger.getAttribute("data-cert-title") || "Sertifika";
                    const alt = trigger.getAttribute("data-cert-alt") || title;
                    if (!src) {
                        return;
                    }
                    openModal(src, title, alt);
                });
            });

            closeButtons.forEach((btn) => btn.addEventListener("click", closeModal));
            modal.addEventListener("click", (event) => {
                if (event.target === modal) {
                    closeModal();
                }
            });
            document.addEventListener("keydown", (event) => {
                if (event.key === "Escape" && modal.classList.contains("flex")) {
                    closeModal();
                }
            });
        });
    </script>
    {% endif %}

{% endblock %}
